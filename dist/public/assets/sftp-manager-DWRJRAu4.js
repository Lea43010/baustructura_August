import{c as D,e as Y,v as ee,u as se,y as te,r as o,w as ie,z,j as e,af as F,C as m,b as P,d as $,a as h,x as Z,B as t,I as R,a4 as re,A as C}from"./index-CyhjQ_VK.js";import{P as ae}from"./page-header-CfMEZ_QD.js";import{H as ne,M as le}from"./mobile-nav-Cu-R2ZoU.js";import{B as G}from"./badge-BZr39Q1C.js";import{S as ce}from"./server-DRk7dtT5.js";import{A as de}from"./arrow-left-C8JrTeqc.js";import{U as oe}from"./upload-DB7pjTN6.js";import{F as q}from"./file-text-BJnhxmUe.js";import{C as me}from"./calendar-DrNP2I0J.js";import{D as he}from"./download-DSsmF7Wj.js";import{T as xe}from"./trash-2-Bnck2P-r.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=D("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=D("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=D("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);function E(x){return/^401: .*Unauthorized/.test(x.message)}function ze(){var U,I,K;const[,x]=Y(),{user:a,isAuthenticated:f,isLoading:u}=ee(),{toast:i}=se();te();const[r,d]=o.useState("/"),[j,N]=o.useState(""),[c,v]=o.useState(null),[L,b]=o.useState(!1),[B,y]=o.useState(!1);o.useEffect(()=>{if(!u&&!f){i({title:"Nicht autorisiert",description:"Sie m√ºssen sich anmelden um fortzufahren.",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}if(!u&&a&&a.role==="user"){i({title:"Zugriff verweigert",description:"SFTP-Zugriff erfordert Manager- oder Admin-Berechtigung.",variant:"destructive"}),x("/");return}},[f,u,a,i,x]);const{data:l,isLoading:w,refetch:g}=ie({queryKey:["/api/sftp/files",r],enabled:!!a&&a.role!=="user",retry:!1}),S=z({mutationFn:async s=>await C("/api/sftp/upload","POST",s),onSuccess:()=>{i({title:"Upload erfolgreich",description:"Datei wurde erfolgreich hochgeladen."}),v(null),b(!1),g()},onError:s=>{if(E(s)){i({title:"Nicht autorisiert",description:"Sie sind abgemeldet. Melden Sie sich erneut an...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}i({title:"Upload fehlgeschlagen",description:"Datei konnte nicht hochgeladen werden.",variant:"destructive"})}}),A=z({mutationFn:async s=>await C(`/api/sftp/files/${s}?path=${encodeURIComponent(r)}`,"DELETE"),onSuccess:()=>{i({title:"Datei gel√∂scht",description:"Datei wurde erfolgreich gel√∂scht."}),g()},onError:s=>{if(E(s)){i({title:"Nicht autorisiert",description:"Sie sind abgemeldet. Melden Sie sich erneut an...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}i({title:"L√∂schung fehlgeschlagen",description:"Datei konnte nicht gel√∂scht werden.",variant:"destructive"})}}),k=z({mutationFn:async s=>await C("/api/sftp/create-folder","POST",s),onSuccess:()=>{i({title:"Ordner erstellt",description:"Ordner wurde erfolgreich erstellt."}),N(""),y(!1),g()},onError:s=>{if(E(s)){i({title:"Nicht autorisiert",description:"Sie sind abgemeldet. Melden Sie sich erneut an...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}i({title:"Erstellung fehlgeschlagen",description:"Ordner konnte nicht erstellt werden.",variant:"destructive"})}}),H=s=>{if(s===0)return"0 B";const n=1024,p=["B","KB","MB","GB"],O=Math.floor(Math.log(s)/Math.log(n));return parseFloat((s/Math.pow(n,O)).toFixed(2))+" "+p[O]},Q=s=>new Date(s).toLocaleDateString("de-DE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),V=s=>{const n=r==="/"?`/${s}`:`${r}/${s}`;d(n)},_=()=>{if(r==="/")return;const s=r.split("/").filter(n=>n);s.pop(),d(s.length===0?"/":`/${s.join("/")}`)},J=s=>{var p;const n=(p=s.target.files)==null?void 0:p[0];n&&v(n)},W=()=>{c&&S.mutate({fileName:c.name,path:r,fileSize:c.size})},X=()=>{j.trim()&&k.mutate({folderName:j.trim(),path:r})};return u?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-green-600"}),e.jsx("p",{className:"text-gray-600",children:"Lade SFTP-Manager..."})]})}):f?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(ae,{children:e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"SFTP-Manager"})}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs(m,{children:[e.jsx(P,{children:e.jsxs($,{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{children:"SFTP-Server Konfiguration"}),e.jsx("div",{className:"ml-auto",children:e.jsx("span",{className:"text-xs text-gray-500 cursor-help",title:"Schnelle Konfigurationshilfe",children:"‚ìò"})})]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Server:"}),e.jsx("p",{className:"text-gray-600",children:(a==null?void 0:a.sftpHost)||"Nicht konfiguriert"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Benutzer:"}),e.jsx("p",{className:"text-gray-600",children:(a==null?void 0:a.sftpUsername)||"Nicht konfiguriert"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Aktueller Pfad:"}),e.jsx("p",{className:"text-gray-600 font-mono",children:r})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-orange-500",children:"*"}),"SFTP-Server Setup Anleitung"]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 space-y-3 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-blue-900 mb-2",children:"üñ•Ô∏è Hetzner Cloud Server"}),e.jsxs("ul",{className:"text-blue-800 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Host:"})," 128.140.82.20"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Port:"})," 22 (SSH/SFTP)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Standort:"})," Deutschland"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Multi-Tenant:"})," Sichere Isolation"]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-blue-900 mb-2",children:"‚öôÔ∏è Server-Konfiguration"}),e.jsxs("ul",{className:"text-blue-800 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"OS:"})," Ubuntu 22.04 LTS"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Service:"})," ProFTPD + PostgreSQL"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"SSL:"})," Verschl√ºsselte √úbertragung"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Kosten:"})," ~5‚Ç¨/Monat f√ºr alle Benutzer"]})]})]})]}),e.jsxs("div",{className:"border-t border-blue-200 pt-3",children:[e.jsx("h5",{className:"font-medium text-blue-900 mb-2",children:"üîß Automatische Einrichtung"}),e.jsxs("p",{className:"text-blue-800",children:[e.jsx("strong",{children:"Nach Lizenz-Aktivierung:"})," SFTP-Accounts werden automatisch erstellt und per E-Mail zugesendet. Keine manuelle Konfiguration erforderlich - alle Einstellungen werden automatisch in Ihrem Profil hinterlegt."]})]}),e.jsxs("div",{className:"border-t border-blue-200 pt-3",children:[e.jsx("h5",{className:"font-medium text-blue-900 mb-2",children:"üìÅ Benutzer-Isolation"}),e.jsxs("div",{className:"bg-white rounded p-2 font-mono text-xs text-gray-700",children:[e.jsx("div",{children:"/var/ftp/user_[USER_ID]/"}),e.jsxs("div",{className:"ml-4",children:["‚îú‚îÄ‚îÄ uploads/ ",e.jsx("span",{className:"text-gray-500",children:"# Ihre Dateien"})]}),e.jsxs("div",{className:"ml-4",children:["‚îú‚îÄ‚îÄ projects/ ",e.jsx("span",{className:"text-gray-500",children:"# Projektdaten"})]}),e.jsxs("div",{className:"ml-4",children:["‚îî‚îÄ‚îÄ backups/ ",e.jsx("span",{className:"text-gray-500",children:"# Backups"})]})]})]}),e.jsxs("div",{className:"border-t border-blue-200 pt-3",children:[e.jsx("h5",{className:"font-medium text-blue-900 mb-2",children:"üöÄ Lizenz-basierte Limits"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white rounded p-2 text-center",children:[e.jsx("div",{className:"font-medium text-green-600",children:"Basic"}),e.jsx("div",{className:"text-gray-600",children:"1GB Speicher"})]}),e.jsxs("div",{className:"bg-white rounded p-2 text-center",children:[e.jsx("div",{className:"font-medium text-blue-600",children:"Professional"}),e.jsx("div",{className:"text-gray-600",children:"5GB Speicher"})]}),e.jsxs("div",{className:"bg-white rounded p-2 text-center",children:[e.jsx("div",{className:"font-medium text-purple-600",children:"Enterprise"}),e.jsx("div",{className:"text-gray-600",children:"20GB Speicher"})]})]})]}),e.jsxs("div",{className:"border-t border-blue-200 pt-3",children:[e.jsx("h5",{className:"font-medium text-blue-900 mb-2",children:"üîë Manuelle Konfiguration (falls erforderlich)"}),e.jsxs("p",{className:"text-blue-800 text-xs",children:["Falls SFTP-Zugang nicht automatisch eingerichtet wurde, k√∂nnen Sie Ihre Zugangsdaten in den ",e.jsx(Z,{to:"/profil",className:"text-blue-600 underline hover:text-blue-800",children:"Profil-Einstellungen"})," manuell konfigurieren."]})]}),e.jsxs("div",{className:"border-t border-blue-200 pt-3",children:[e.jsx("h5",{className:"font-medium text-blue-900 mb-2",children:"üìû Support"}),e.jsxs("p",{className:"text-blue-800 text-xs",children:["Bei Problemen mit der SFTP-Konfiguration wenden Sie sich an:",e.jsx("span",{className:"font-mono bg-white px-1 rounded",children:"support@bau-structura.de"})]})]})]})]})]})]}),e.jsxs(m,{children:[e.jsx(P,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-semibold",children:"Datei-Browser"}),e.jsxs(G,{variant:"outline",children:[((U=l==null?void 0:l.files)==null?void 0:U.length)||0," Eintr√§ge"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>d("/"),disabled:r==="/",children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Root"]}),e.jsxs(t,{variant:"outline",size:"sm",onClick:_,disabled:r==="/",children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),"Zur√ºck"]}),e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>g(),disabled:w,children:[e.jsx(F,{className:`h-4 w-4 mr-1 ${w?"animate-spin":""}`}),"Aktualisieren"]})]})]})}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(t,{onClick:()=>b(!L),size:"sm",className:"bg-green-600 hover:bg-green-700",children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Datei hochladen"]}),e.jsxs(t,{onClick:()=>y(!B),variant:"outline",size:"sm",children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"Ordner erstellen"]})]}),L&&e.jsx(m,{className:"border-green-200 bg-green-50",children:e.jsx(h,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Datei ausw√§hlen:"}),e.jsx(R,{type:"file",onChange:J,className:"bg-white"})]}),c&&e.jsxs("div",{className:"p-2 bg-white rounded border text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Datei:"})," ",c.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Gr√∂√üe:"})," ",H(c.size)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ziel:"})," ",r]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{onClick:W,disabled:!c||S.isPending,size:"sm",children:S.isPending?"Lade hoch...":"Hochladen"}),e.jsx(t,{onClick:()=>{b(!1),v(null)},variant:"outline",size:"sm",children:"Abbrechen"})]})]})})}),B&&e.jsx(m,{className:"border-blue-200 bg-blue-50",children:e.jsx(h,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Ordnername:"}),e.jsx(R,{value:j,onChange:s=>N(s.target.value),placeholder:"Neuer Ordner",className:"bg-white"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{onClick:X,disabled:!j.trim()||k.isPending,size:"sm",children:k.isPending?"Erstelle...":"Erstellen"}),e.jsx(t,{onClick:()=>{y(!1),N("")},variant:"outline",size:"sm",children:"Abbrechen"})]})]})})}),w?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(F,{className:"h-6 w-6 animate-spin mx-auto mb-2 text-green-600"}),e.jsx("p",{className:"text-gray-600",children:"Lade Dateien..."})]}):e.jsxs("div",{className:"space-y-2",children:[(I=l==null?void 0:l.files)==null?void 0:I.map((s,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[s.type==="directory"?e.jsx(M,{className:"h-5 w-5 text-blue-600 flex-shrink-0"}):e.jsx(q,{className:"h-5 w-5 text-gray-600 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[s.type==="directory"?e.jsx("button",{onClick:()=>V(s.name),className:"font-medium text-blue-600 hover:text-blue-800 truncate",children:s.name}):e.jsx("span",{className:"font-medium text-gray-900 truncate",children:s.name}),e.jsx(G,{variant:"outline",className:"text-xs",children:s.permissions})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 mt-1",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),H(s.size)]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),Q(s.modified)]})]})]})]}),s.type==="file"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{variant:"outline",size:"sm",onClick:()=>{i({title:"Download",description:`Download von ${s.name} wird gestartet...`})},children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(t,{variant:"outline",size:"sm",onClick:()=>{confirm(`Sind Sie sicher, dass Sie "${s.name}" l√∂schen m√∂chten?`)&&A.mutate(s.name)},disabled:A.isPending,children:e.jsx(xe,{className:"h-4 w-4 text-red-600"})})]})]},n)),((K=l==null?void 0:l.files)==null?void 0:K.length)===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(M,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"Dieser Ordner ist leer"})]})]})]})})]}),e.jsxs(m,{children:[e.jsx(P,{children:e.jsx($,{className:"text-sm font-medium",children:"Schnellzugriff"})}),e.jsx(h,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>d("/projects"),className:"justify-start",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Projekte"]}),e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>d("/documents"),className:"justify-start",children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Dokumente"]}),e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>d("/backup"),className:"justify-start",children:[e.jsx(T,{className:"h-4 w-4 mr-1"}),"Backup"]}),e.jsx(Z,{to:"/profile",children:e.jsxs(t,{variant:"outline",size:"sm",className:"w-full justify-start",children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),"Einstellungen"]})})]})})]})]}),e.jsx(le,{})]}):null}export{ze as default};
