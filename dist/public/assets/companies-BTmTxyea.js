import{y as se,r as d,w as E,z as p,j as e,B as c,D as t,I as i,C as q,b as M,d as T,a as z,M as I,U as ae,A as j,ab as g}from"./index-CyhjQ_VK.js";import{B as te}from"./badge-BZr39Q1C.js";import{D as $,f as K,a as O,b as B,c as H}from"./dialog-DY-DCoN7.js";import{B as ie}from"./building-2-C2UTDJSA.js";import{P as Q}from"./plus-D7MkCcQh.js";import{P as L}from"./phone-B_7AkKIg.js";import{M as ne}from"./map-pin-LITRY39W.js";import{S as R}from"./square-pen-DsHIieuw.js";import{T as le}from"./trash-2-Bnck2P-r.js";import"./Combination-DDccCRPx.js";function ge(){var k;const u=se(),[U,m]=d.useState(!1),[W,h]=d.useState(!1),[v,b]=d.useState(null),[C,f]=d.useState(null),[n,V]=d.useState(null),[l,r]=d.useState({name:"",email:"",phone:"",street:"",houseNumber:"",postalCode:"",city:"",website:""}),[x,o]=d.useState({name:"",email:"",phone:"",department:"",position:""}),{data:N=[]}=E({queryKey:["/api/companies"]}),{data:w=[]}=E({queryKey:[`/api/companies/${n}/contacts`],enabled:!!n}),S=p({mutationFn:s=>j("/api/companies","POST",s),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/companies"]}),m(!1),y(),g({title:"Firma erfolgreich erstellt"})}}),P=p({mutationFn:({id:s,data:a})=>j(`/api/companies/${s}`,"PATCH",a),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/companies"]}),m(!1),b(null),y(),g({title:"Firma erfolgreich aktualisiert"})}}),A=p({mutationFn:s=>j("/api/company-contacts","POST",s),onSuccess:()=>{u.invalidateQueries({queryKey:[`/api/companies/${n}/contacts`]}),h(!1),F(),g({title:"Ansprechpartner erfolgreich erstellt"})}}),D=p({mutationFn:({id:s,data:a})=>j(`/api/company-contacts/${s}`,"PATCH",a),onSuccess:()=>{u.invalidateQueries({queryKey:[`/api/companies/${n}/contacts`]}),h(!1),f(null),F(),g({title:"Ansprechpartner erfolgreich aktualisiert"})}}),Z=p({mutationFn:s=>j(`/api/company-contacts/${s}`,"DELETE"),onSuccess:()=>{u.invalidateQueries({queryKey:[`/api/companies/${n}/contacts`]}),g({title:"Ansprechpartner erfolgreich gelöscht"})}}),y=()=>{r({name:"",email:"",phone:"",street:"",houseNumber:"",postalCode:"",city:"",website:""})},F=()=>{o({name:"",email:"",phone:"",department:"",position:""})},G=s=>{s.preventDefault(),v?P.mutate({id:v.id,data:l}):S.mutate(l)},J=s=>{s.preventDefault();const a={...x,companyId:n};C?D.mutate({id:C.id,data:a}):A.mutate(a)},X=s=>{b(s),r({name:s.name,email:s.email||"",phone:s.phone||"",street:s.street||"",houseNumber:s.houseNumber||"",postalCode:s.postalCode||"",city:s.city||"",website:s.website||""}),m(!0)},Y=s=>{f(s),o({name:s.name,email:s.email||"",phone:s.phone||"",department:s.department||"",position:s.position||""}),h(!0)},_=()=>{b(null),y(),m(!0)},ee=()=>{f(null),F(),h(!0)};return e.jsxs("div",{className:"container mx-auto mobile-spacing max-w-7xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx(ie,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-600"}),e.jsx("h1",{className:"text-xl sm:text-3xl font-bold",children:"Firmen-Verwaltung"})]}),e.jsxs($,{open:U,onOpenChange:m,children:[e.jsx(K,{asChild:!0,children:e.jsxs(c,{onClick:_,className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:"Neue Firma"})]})}),e.jsxs(O,{className:"max-w-2xl",children:[e.jsx(B,{children:e.jsx(H,{children:v?"Firma bearbeiten":"Neue Firma erstellen"})}),e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"name",children:"Firmenname *"}),e.jsx(i,{id:"name",value:l.name,onChange:s=>r(a=>({...a,name:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"email",children:"E-Mail"}),e.jsx(i,{id:"email",type:"email",value:l.email,onChange:s=>r(a=>({...a,email:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"phone",children:"Telefon"}),e.jsx(i,{id:"phone",value:l.phone,onChange:s=>r(a=>({...a,phone:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"website",children:"Website"}),e.jsx(i,{id:"website",value:l.website,onChange:s=>r(a=>({...a,website:s.target.value}))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"street",children:"Straße"}),e.jsx(i,{id:"street",value:l.street,onChange:s=>r(a=>({...a,street:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"houseNumber",children:"Hausnummer"}),e.jsx(i,{id:"houseNumber",value:l.houseNumber,onChange:s=>r(a=>({...a,houseNumber:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"postalCode",children:"PLZ"}),e.jsx(i,{id:"postalCode",value:l.postalCode,onChange:s=>r(a=>({...a,postalCode:s.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"city",children:"Stadt"}),e.jsx(i,{id:"city",value:l.city,onChange:s=>r(a=>({...a,city:s.target.value}))})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Abbrechen"}),e.jsx(c,{type:"submit",disabled:S.isPending||P.isPending,children:v?"Aktualisieren":"Erstellen"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(q,{children:[e.jsx(M,{children:e.jsxs(T,{children:["Firmen (",N.length,")"]})}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-3",children:[N.map(s=>e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${n===s.id?"bg-blue-50 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>V(s.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsxs(te,{variant:"outline",children:["ID: ",s.id]})]}),s.email&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 mb-1",children:[e.jsx(I,{className:"h-3 w-3"}),e.jsx("span",{children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 mb-1",children:[e.jsx(L,{className:"h-3 w-3"}),e.jsx("span",{children:s.phone})]}),(s.street||s.city)&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(ne,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:[s.street,s.houseNumber,s.postalCode,s.city].filter(Boolean).join(" ")})]})]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),X(s)},children:e.jsx(R,{className:"h-4 w-4"})})]})},s.id)),N.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Noch keine Firmen vorhanden. Erstellen Sie Ihre erste Firma."})]})})]}),e.jsxs(q,{children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(T,{children:n?`Ansprechpartner - ${(k=N.find(s=>s.id===n))==null?void 0:k.name}`:"Ansprechpartner"}),n&&e.jsxs($,{open:W,onOpenChange:h,children:[e.jsx(K,{asChild:!0,children:e.jsxs(c,{onClick:ee,size:"sm",children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Hinzufügen"]})}),e.jsxs(O,{children:[e.jsx(B,{children:e.jsx(H,{children:C?"Ansprechpartner bearbeiten":"Neuen Ansprechpartner hinzufügen"})}),e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"contactName",children:"Name *"}),e.jsx(i,{id:"contactName",value:x.name,onChange:s=>o(a=>({...a,name:s.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"contactEmail",children:"E-Mail"}),e.jsx(i,{id:"contactEmail",type:"email",value:x.email,onChange:s=>o(a=>({...a,email:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"contactPhone",children:"Telefon"}),e.jsx(i,{id:"contactPhone",value:x.phone,onChange:s=>o(a=>({...a,phone:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"department",children:"Abteilung"}),e.jsx(i,{id:"department",value:x.department,onChange:s=>o(a=>({...a,department:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"position",children:"Position"}),e.jsx(i,{id:"position",value:x.position,onChange:s=>o(a=>({...a,position:s.target.value}))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>h(!1),children:"Abbrechen"}),e.jsx(c,{type:"submit",disabled:A.isPending||D.isPending,children:C?"Aktualisieren":"Hinzufügen"})]})]})]})]})]})}),e.jsx(z,{children:n?e.jsxs("div",{className:"space-y-3",children:[w.map(s=>e.jsx("div",{className:"p-3 border rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(ae,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:s.name})]}),s.position&&e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:s.position}),s.department&&e.jsxs("p",{className:"text-sm text-gray-500 mb-1",children:["Abteilung: ",s.department]}),s.email&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 mb-1",children:[e.jsx(I,{className:"h-3 w-3"}),e.jsx("span",{children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(L,{className:"h-3 w-3"}),e.jsx("span",{children:s.phone})]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>Y(s),children:e.jsx(R,{className:"h-3 w-3"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>Z.mutate(s.id),children:e.jsx(le,{className:"h-3 w-3"})})]})]})},s.id)),w.length===0&&e.jsx("p",{className:"text-gray-500 text-center py-6",children:"Keine Ansprechpartner für diese Firma vorhanden."})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"Wählen Sie eine Firma aus, um Ansprechpartner zu verwalten."})})]})]})]})}export{ge as default};
