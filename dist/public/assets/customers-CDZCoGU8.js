import{r as h,u as ie,y as te,w as D,z as j,j as e,B as r,D as i,I as t,C as f,b as P,d as T,a as b,M as q,A as g}from"./index-CyhjQ_VK.js";import{D as M,f as z,a as O,b as B,c as Q}from"./dialog-DY-DCoN7.js";import{B as $}from"./badge-BZr39Q1C.js";import{U as I}from"./users-cXk-SK6P.js";import{P as y}from"./plus-D7MkCcQh.js";import{P as L}from"./phone-B_7AkKIg.js";import{M as re}from"./map-pin-LITRY39W.js";import{S as H}from"./square-pen-DsHIieuw.js";import{B as U}from"./building-2-C2UTDJSA.js";import{T as le}from"./trash-2-Bnck2P-r.js";import"./Combination-DDccCRPx.js";function Ne(){const[R,x]=h.useState(!1),[V,p]=h.useState(!1),[v,C]=h.useState(null),[N,w]=h.useState(null),[a,W]=h.useState(null),[l,d]=h.useState({name:"",email:"",phone:"",street:"",houseNumber:"",postalCode:"",city:""}),[o,m]=h.useState({name:"",email:"",phone:"",department:"",position:""}),{toast:c}=ie(),u=te(),{data:F=[],isLoading:Z}=D({queryKey:["/api/customers"]}),{data:K=[]}=D({queryKey:["/api/customers",a==null?void 0:a.id,"contacts"],enabled:!!(a!=null&&a.id)}),G=j({mutationFn:s=>g("/api/customers","POST",s),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/customers"]}),x(!1),S(),c({description:"Kunde erfolgreich erstellt"})},onError:()=>{c({variant:"destructive",description:"Fehler beim Erstellen des Kunden"})}}),J=j({mutationFn:({id:s,data:n})=>g(`/api/customers/${s}`,"PUT",n),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/customers"]}),x(!1),C(null),S(),c({description:"Kunde erfolgreich aktualisiert"})},onError:()=>{c({variant:"destructive",description:"Fehler beim Aktualisieren des Kunden"})}}),X=j({mutationFn:s=>g(`/api/customers/${a==null?void 0:a.id}/contacts`,"POST",s),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/customers",a==null?void 0:a.id,"contacts"]}),p(!1),E(),c({description:"Ansprechpartner erfolgreich erstellt"})},onError:()=>{c({variant:"destructive",description:"Fehler beim Erstellen des Ansprechpartners"})}}),Y=j({mutationFn:({id:s,data:n})=>g(`/api/customers/${a==null?void 0:a.id}/contacts/${s}`,"PUT",n),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/customers",a==null?void 0:a.id,"contacts"]}),p(!1),w(null),E(),c({description:"Ansprechpartner erfolgreich aktualisiert"})},onError:()=>{c({variant:"destructive",description:"Fehler beim Aktualisieren des Ansprechpartners"})}}),_=j({mutationFn:s=>g(`/api/customers/${a==null?void 0:a.id}/contacts/${s}`,"DELETE"),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/customers",a==null?void 0:a.id,"contacts"]}),c({description:"Ansprechpartner erfolgreich gelöscht"})},onError:()=>{c({variant:"destructive",description:"Fehler beim Löschen des Ansprechpartners"})}}),ee=s=>{s.preventDefault(),v?J.mutate({id:v.id,data:l}):G.mutate(l)},se=s=>{if(s.preventDefault(),!a)return;const n={...o,customerId:a.id};N?Y.mutate({id:N.id,data:n}):X.mutate(n)},S=()=>{d({name:"",email:"",phone:"",street:"",houseNumber:"",postalCode:"",city:""})},E=()=>{m({name:"",email:"",phone:"",department:"",position:""})},ae=s=>{C(s),d({name:s.name,email:s.email||"",phone:s.phone||"",street:s.street||"",houseNumber:s.houseNumber||"",postalCode:s.postalCode||"",city:s.city||""}),x(!0)},ne=s=>{w(s),m({name:s.name,email:s.email||"",phone:s.phone||"",department:s.department||"",position:s.position||""}),p(!0)},A=()=>{C(null),S(),x(!0)},k=()=>{w(null),E(),p(!0)};return e.jsxs("div",{className:"container mx-auto p-3 sm:p-6 max-w-7xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx(I,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-600"}),e.jsx("h1",{className:"text-xl sm:text-3xl font-bold",children:"Kunden-Verwaltung"})]}),e.jsxs(M,{open:R,onOpenChange:x,children:[e.jsx(z,{asChild:!0,children:e.jsxs(r,{onClick:A,className:"flex items-center space-x-2",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{children:"Neuer Kunde"})]})}),e.jsxs(O,{className:"max-w-2xl",children:[e.jsx(B,{children:e.jsx(Q,{children:v?"Kunde bearbeiten":"Neuen Kunden erstellen"})}),e.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"name",children:"Kundenname *"}),e.jsx(t,{id:"name",value:l.name,onChange:s=>d(n=>({...n,name:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email",children:"E-Mail"}),e.jsx(t,{id:"email",type:"email",value:l.email,onChange:s=>d(n=>({...n,email:s.target.value}))})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx(i,{htmlFor:"phone",children:"Telefon"}),e.jsx(t,{id:"phone",value:l.phone,onChange:s=>d(n=>({...n,phone:s.target.value}))})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"street",children:"Straße"}),e.jsx(t,{id:"street",value:l.street,onChange:s=>d(n=>({...n,street:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"houseNumber",children:"Hausnummer"}),e.jsx(t,{id:"houseNumber",value:l.houseNumber,onChange:s=>d(n=>({...n,houseNumber:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"postalCode",children:"PLZ"}),e.jsx(t,{id:"postalCode",value:l.postalCode,onChange:s=>d(n=>({...n,postalCode:s.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"city",children:"Stadt"}),e.jsx(t,{id:"city",value:l.city,onChange:s=>d(n=>({...n,city:s.target.value}))})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Abbrechen"}),e.jsx(r,{type:"submit",disabled:!l.name.trim(),children:v?"Aktualisieren":"Erstellen"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(f,{children:[e.jsx(P,{children:e.jsx(T,{className:"flex items-center space-x-2",children:e.jsxs("span",{children:["Kunden (",F.length,")"]})})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-4",children:Z?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Lade Kunden..."})]}):F.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(I,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Noch keine Kunden erstellt"}),e.jsxs(r,{onClick:A,className:"mt-4",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Ersten Kunden erstellen"]})]}):F.map(s=>e.jsx(f,{className:`cursor-pointer transition-all ${(a==null?void 0:a.id)===s.id?"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/20":"hover:shadow-md"}`,onClick:()=>W(s),children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsxs($,{variant:"secondary",className:"text-xs",children:["ID: ",s.id]})]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[s.email&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-3 w-3"}),e.jsx("span",{children:s.phone})]}),(s.street||s.city)&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:[s.street,s.houseNumber,s.postalCode,s.city].filter(Boolean).join(" ")})]})]})]}),e.jsx(r,{variant:"ghost",size:"sm",onClick:n=>{n.stopPropagation(),ae(s)},children:e.jsx(H,{className:"h-4 w-4"})})]})})},s.id))})})]}),e.jsxs(f,{children:[e.jsx(P,{children:e.jsxs(T,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Ansprechpartner"}),a&&e.jsxs(M,{open:V,onOpenChange:p,children:[e.jsx(z,{asChild:!0,children:e.jsxs(r,{size:"sm",onClick:k,className:"flex items-center space-x-1",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{children:"Hinzufügen"})]})}),e.jsxs(O,{children:[e.jsx(B,{children:e.jsx(Q,{children:N?"Ansprechpartner bearbeiten":"Neuer Ansprechpartner"})}),e.jsxs("form",{onSubmit:se,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"contactName",children:"Name *"}),e.jsx(t,{id:"contactName",value:o.name,onChange:s=>m(n=>({...n,name:s.target.value})),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"contactEmail",children:"E-Mail"}),e.jsx(t,{id:"contactEmail",type:"email",value:o.email,onChange:s=>m(n=>({...n,email:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"contactPhone",children:"Telefon"}),e.jsx(t,{id:"contactPhone",value:o.phone,onChange:s=>m(n=>({...n,phone:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"department",children:"Abteilung"}),e.jsx(t,{id:"department",value:o.department,onChange:s=>m(n=>({...n,department:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"position",children:"Position"}),e.jsx(t,{id:"position",value:o.position,onChange:s=>m(n=>({...n,position:s.target.value}))})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Abbrechen"}),e.jsx(r,{type:"submit",disabled:!o.name.trim(),children:N?"Aktualisieren":"Erstellen"})]})]})]})]})]})}),e.jsx(b,{children:a?K.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["Keine Ansprechpartner für ",a.name]}),e.jsxs(r,{onClick:k,children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Ersten Ansprechpartner hinzufügen"]})]}):e.jsx("div",{className:"space-y-3",children:K.map(s=>e.jsx(f,{className:"hover:shadow-sm transition-shadow",children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h4",{className:"font-medium",children:s.name}),s.position&&e.jsx($,{variant:"outline",className:"text-xs",children:s.position})]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[s.department&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"h-3 w-3"}),e.jsx("span",{children:s.department})]}),s.email&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-3 w-3"}),e.jsx("span",{children:s.phone})]})]})]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>ne(s),children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>_.mutate(s.id),children:e.jsx(le,{className:"h-4 w-4"})})]})]})})},s.id))}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Wählen Sie einen Kunden aus, um Ansprechpartner zu verwalten."})})]})]})]})}export{Ne as default};
