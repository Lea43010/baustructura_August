import{c as y,e as q,r as a,u as G,y as L,w as K,z as $,j as e,B as i,X as w,C as O,a as Z,D as N,I as Q,A as V}from"./index-CyhjQ_VK.js";import{B as U}from"./badge-BZr39Q1C.js";import{S as H,a as X,b as J,c as Y,d as _}from"./select-D1rr0yyK.js";import{S as ee}from"./settings-RhnSVDqX.js";import{C as te}from"./circle-DZ9vjeD0.js";import{T as se}from"./target-BuWE3s4A.js";import{M as ae}from"./map-pin-LITRY39W.js";import{S as ie}from"./save-BWvkuADS.js";import"./index-BdQq_4o_.js";import"./Combination-DDccCRPx.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=y("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=y("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function pe(){const[,k]=q(),[g,S]=a.useState(!1),[C,P]=a.useState("photo"),[j,F]=a.useState(null),[o,n]=a.useState(null),[z,c]=a.useState(!1),[d,p]=a.useState(""),[f,v]=a.useState(""),[s,D]=a.useState(null),r=a.useRef(null),h=a.useRef(null),{toast:u}=G(),M=L(),{data:I=[]}=K({queryKey:["/api/projects"]}),m=$({mutationFn:async t=>await V("/api/photos","POST",t),onSuccess:()=>{u({title:"Foto gespeichert",description:"Das Foto wurde erfolgreich zum Projekt hinzugefügt."}),M.invalidateQueries({queryKey:["/api/photos"]}),n(null),c(!1),v(""),p("")},onError:t=>{u({title:"Fehler beim Speichern",description:"Das Foto konnte nicht gespeichert werden.",variant:"destructive"})}});a.useEffect(()=>(R(),T(),()=>{j&&j.getTracks().forEach(t=>t.stop())}),[]);const R=async()=>{try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}});F(t),r.current&&(r.current.srcObject=t)}catch(t){console.error("Kamera-Zugriff fehlgeschlagen:",t),u({title:"Kamera-Fehler",description:"Zugriff auf die Kamera fehlgeschlagen. Bitte Berechtigungen prüfen.",variant:"destructive"})}},T=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(t=>{D({lat:t.coords.latitude,lng:t.coords.longitude})},t=>{console.error("GPS-Fehler:",t)})},B=()=>{k("/")},A=()=>{if(!r.current||!h.current)return;const t=h.current,x=r.current,b=t.getContext("2d");if(!b)return;t.width=x.videoWidth,t.height=x.videoHeight,b.drawImage(x,0,0,t.width,t.height);const l=document.createElement("div");l.className="fixed inset-0 bg-white z-50 opacity-0 pointer-events-none",document.body.appendChild(l),l.style.opacity="0.8",setTimeout(()=>{l.style.opacity="0",setTimeout(()=>document.body.removeChild(l),200)},100);const W=t.toDataURL("image/jpeg",.8);n(W),c(!0)},E=()=>{if(!o||!d)return;const t=parseInt(d);m.mutate({projectId:t,description:f,imageData:o,latitude:s==null?void 0:s.lat,longitude:s==null?void 0:s.lng})};return e.jsxs("div",{className:"min-h-screen bg-black",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 bg-black/50 text-white z-40",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{variant:"ghost",size:"sm",className:"text-white",onClick:B,children:e.jsx(w,{className:"h-4 w-4"})}),e.jsx("h1",{className:"font-semibold",children:"Foto aufnehmen"}),e.jsx(i,{variant:"ghost",size:"sm",className:"text-white",children:e.jsx(ee,{className:"h-4 w-4"})})]})})}),e.jsxs("div",{className:"relative h-screen bg-black",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:h,className:"hidden"}),e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("div",{className:"absolute top-20 left-4 bg-black/50 text-white px-3 py-1 rounded-full text-xs",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${s?"bg-green-400":"bg-red-400"}`}),"GPS: ",s?`${s.lat.toFixed(3)}°N, ${s.lng.toFixed(3)}°E`:"Wird ermittelt..."]})}),e.jsx("div",{className:"absolute top-20 right-4 bg-black/50 text-white px-3 py-1 rounded-full text-xs",children:"Aktuelles Projekt"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsxs("svg",{width:"200",height:"200",className:"text-white opacity-30",children:[e.jsx("line",{x1:"0",y1:"66",x2:"200",y2:"66",stroke:"currentColor",strokeWidth:"1"}),e.jsx("line",{x1:"0",y1:"133",x2:"200",y2:"133",stroke:"currentColor",strokeWidth:"1"}),e.jsx("line",{x1:"66",y1:"0",x2:"66",y2:"200",stroke:"currentColor",strokeWidth:"1"}),e.jsx("line",{x1:"133",y1:"0",x2:"133",y2:"200",stroke:"currentColor",strokeWidth:"1"})]})})]})]}),e.jsxs("div",{className:"absolute bottom-8 left-0 right-0 px-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-300 rounded-lg overflow-hidden",children:e.jsx("img",{src:"https://images.unsplash.com/photo-1577495508048-b635879837f1?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&h=300",alt:"Last photo thumbnail",className:"w-full h-full object-cover"})}),e.jsx("button",{onClick:A,className:"w-20 h-20 bg-white rounded-full flex items-center justify-center border-4 border-gray-300 hover:bg-gray-100 transition-colors",children:e.jsx("div",{className:"w-16 h-16 bg-white rounded-full border-2 border-gray-400 flex items-center justify-center",children:e.jsx(te,{className:"h-8 w-8 text-gray-600"})})}),e.jsx(i,{variant:"ghost",size:"icon",className:"w-12 h-12 bg-black/50 text-white hover:bg-black/70",children:e.jsx(re,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"flex justify-center space-x-6 mt-6",children:["video","photo","panorama"].map(t=>e.jsx("button",{onClick:()=>P(t),className:`text-sm capitalize ${C===t?"text-white font-semibold":"text-white/50"}`,children:t==="video"?"Video":t==="photo"?"Foto":"Panorama"},t))})]}),e.jsxs("div",{className:"absolute top-24 left-4 space-y-3",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"w-10 h-10 bg-black/50 text-white hover:bg-black/70",onClick:()=>S(!g),children:e.jsx(le,{className:`h-5 w-5 ${g?"text-yellow-400":"text-white"}`})}),e.jsx(i,{variant:"ghost",size:"icon",className:"w-10 h-10 bg-black/50 text-white hover:bg-black/70",children:e.jsx(se,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"absolute bottom-32 left-4 right-4",children:e.jsx(O,{className:"bg-black/50 border-0",children:e.jsx(Z,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between text-white text-xs",children:[e.jsx("span",{children:"Automatisches Geo-Tagging"}),e.jsx(U,{variant:"secondary",className:"bg-green-500 text-white",children:"GPS aktiv"})]})})})})]}),z&&o&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Foto speichern"}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>{c(!1),n(null)},children:e.jsx(w,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"aspect-video bg-gray-100 rounded-lg overflow-hidden mb-4",children:e.jsx("img",{src:o,alt:"Aufgenommenes Foto",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(N,{htmlFor:"project-select",children:"Projekt auswählen *"}),e.jsxs(H,{value:d,onValueChange:p,children:[e.jsx(X,{children:e.jsx(J,{placeholder:"Projekt auswählen..."})}),e.jsx(Y,{children:I.map(t=>e.jsxs(_,{value:t.id.toString(),children:[t.name," (#",t.id,")"]},t.id))})]})]}),e.jsxs("div",{children:[e.jsx(N,{htmlFor:"description",children:"Beschreibung"}),e.jsx(Q,{id:"description",placeholder:"Was ist auf dem Foto zu sehen?",value:f,onChange:t=>v(t.target.value)})]}),s&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsxs("span",{children:["GPS: ",s.lat.toFixed(6),", ",s.lng.toFixed(6)]})]})]})]}),e.jsxs("div",{className:"p-4 border-t bg-gray-50 flex space-x-2",children:[e.jsx(i,{variant:"outline",onClick:()=>{c(!1),n(null)},className:"flex-1",children:"Abbrechen"}),e.jsxs(i,{onClick:E,disabled:!d||m.isPending,className:"flex-1",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),m.isPending?"Speichert...":"Speichern"]})]})]})})]})}export{pe as default};
