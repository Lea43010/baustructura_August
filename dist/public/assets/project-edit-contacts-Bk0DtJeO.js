import{a1 as z,e as L,u as E,y as V,r as D,w as o,z as Q,j as e,x as m,B as v,C as O,b as U,d as M,a as H,D as a,I as l,U as F}from"./index-CyhjQ_VK.js";import{T as J}from"./textarea-BuGvpmpE.js";import{S as h,a as u,b as p,c as x,d as r}from"./select-D1rr0yyK.js";import{A as R}from"./arrow-left-C8JrTeqc.js";import{B as Z}from"./building-2-C2UTDJSA.js";import{S as G}from"./save-BWvkuADS.js";import"./index-BdQq_4o_.js";import"./Combination-DDccCRPx.js";function ae(){const{id:d}=z(),[,k]=L(),{toast:b}=E(),f=V(),[s,j]=D.useState({name:"",description:"",status:"planning",budget:"",startDate:"",endDate:"",latitude:"",longitude:"",completionPercentage:0,customerId:"",customerContactId:"",companyId:"",companyContactId:""}),{data:n,isLoading:K}=o({queryKey:[`/api/projects/${d}`],enabled:!!d}),{data:A=[]}=o({queryKey:["/api/customers"]}),{data:$=[]}=o({queryKey:["/api/companies"]}),{data:I=[]}=o({queryKey:[`/api/customers/${s.customerId}/contacts`],enabled:!!s.customerId&&s.customerId!==""}),{data:C=[]}=o({queryKey:[`/api/companies/${s.companyId}/contacts`],enabled:!!s.companyId&&s.companyId!=="0"});D.useEffect(()=>{var t,c,g,N,S,P,w;n&&j({name:n.name,description:n.description||"",status:n.status,budget:((t=n.budget)==null?void 0:t.toString())||"",startDate:n.startDate?new Date(n.startDate).toISOString().split("T")[0]:"",endDate:n.endDate?new Date(n.endDate).toISOString().split("T")[0]:"",latitude:((c=n.latitude)==null?void 0:c.toString())||"",longitude:((g=n.longitude)==null?void 0:g.toString())||"",completionPercentage:n.completionPercentage||0,customerId:((N=n.customerId)==null?void 0:N.toString())||"",customerContactId:((S=n.customerContactId)==null?void 0:S.toString())||"",companyId:((P=n.companyId)==null?void 0:P.toString())||"",companyContactId:((w=n.companyContactId)==null?void 0:w.toString())||""})},[n]);const y=Q({mutationFn:async t=>{const c=await fetch(`/api/projects/${d}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,customerId:t.customerId?parseInt(t.customerId):null,customerContactId:t.customerContactId?parseInt(t.customerContactId):null,companyContactId:t.companyContactId?parseInt(t.companyContactId):null})});if(!c.ok)throw new Error("Failed to update project");return c.json()},onSuccess:()=>{b({title:"Projekt aktualisiert",description:"Die Projektdaten wurden erfolgreich gespeichert."}),f.invalidateQueries({queryKey:[`/api/projects/${d}`]}),f.invalidateQueries({queryKey:["/api/projects"]}),k(`/projects/${d}`)},onError:()=>{b({title:"Fehler beim Speichern",description:"Das Projekt konnte nicht aktualisiert werden.",variant:"destructive"})}}),B=t=>{t.preventDefault(),y.mutate(s)},i=(t,c)=>{j(g=>({...g,[t]:c}))},T=t=>{j(c=>({...c,customerId:t,customerContactId:"0"}))},q=t=>{j(c=>({...c,companyId:t,companyContactId:"0"}))};return K?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Lade Projektdaten..."})]})}):n?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-green-500 text-white sticky top-0 z-40",children:e.jsx("div",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(m,{href:`/projects/${d}`,children:e.jsx(v,{variant:"ghost",size:"sm",className:"text-white hover:bg-green-600",children:e.jsx(R,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-semibold truncate",children:"Projekt bearbeiten"}),e.jsx("p",{className:"text-xs opacity-80",children:n.name})]})]})})})}),e.jsx("div",{className:"p-4 pb-20",children:e.jsxs(O,{children:[e.jsx(U,{children:e.jsx(M,{children:"Projektdaten mit Ansprechpartnern"})}),e.jsx(H,{children:e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"name",children:"Projektname *"}),e.jsx(l,{id:"name",value:s.name,onChange:t=>i("name",t.target.value),placeholder:"Projektname eingeben",required:!0})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"description",children:"Beschreibung"}),e.jsx(J,{id:"description",value:s.description,onChange:t=>i("description",t.target.value),placeholder:"Projektbeschreibung eingeben",rows:3})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"status",children:"Status"}),e.jsxs(h,{value:s.status,onValueChange:t=>i("status",t),children:[e.jsx(u,{children:e.jsx(p,{placeholder:"Status auswählen"})}),e.jsxs(x,{children:[e.jsx(r,{value:"planning",children:"Planung"}),e.jsx(r,{value:"active",children:"Aktiv"}),e.jsx(r,{value:"completed",children:"Abgeschlossen"}),e.jsx(r,{value:"cancelled",children:"Abgebrochen"})]})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center",children:[e.jsx(F,{className:"h-5 w-5 mr-2"}),"Ansprechpartner-Verwaltung"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:"h-4 w-4 text-blue-500"}),e.jsx(a,{className:"text-sm font-medium",children:"Kunde"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"customerId",children:"Kunde auswählen"}),e.jsxs(h,{value:s.customerId,onValueChange:T,children:[e.jsx(u,{children:e.jsx(p,{placeholder:"Kunde auswählen"})}),e.jsxs(x,{children:[e.jsx(r,{value:"0",children:"Kein Kunde"}),A.map(t=>e.jsx(r,{value:t.id.toString(),children:t.name},t.id))]})]})]}),s.customerId&&e.jsxs("div",{children:[e.jsx(a,{htmlFor:"customerContactId",children:"Ansprechpartner Kunde"}),e.jsxs(h,{value:s.customerContactId,onValueChange:t=>i("customerContactId",t),children:[e.jsx(u,{children:e.jsx(p,{placeholder:"Ansprechpartner auswählen"})}),e.jsxs(x,{children:[e.jsx(r,{value:"0",children:"Kein Ansprechpartner"}),I.map(t=>e.jsxs(r,{value:t.id.toString(),children:[t.name," ",t.position&&`(${t.position})`]},t.id))]})]}),I.length===0&&s.customerId&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Keine Ansprechpartner für diesen Kunden vorhanden.",e.jsx(m,{href:"/customers",className:"text-blue-500 hover:underline ml-1",children:"Ansprechpartner hinzufügen"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{className:"h-4 w-4 text-orange-500"}),e.jsx(a,{className:"text-sm font-medium",children:"Firma"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"companyId",children:"Firma auswählen"}),e.jsxs(h,{value:s.companyId,onValueChange:q,children:[e.jsx(u,{children:e.jsx(p,{placeholder:"Firma auswählen"})}),e.jsxs(x,{children:[e.jsx(r,{value:"0",children:"Keine Firma"}),$.map(t=>e.jsx(r,{value:t.id.toString(),children:t.name},t.id))]})]})]}),s.companyId&&e.jsxs("div",{children:[e.jsx(a,{htmlFor:"companyContactId",children:"Ansprechpartner Firma"}),e.jsxs(h,{value:s.companyContactId,onValueChange:t=>i("companyContactId",t),children:[e.jsx(u,{children:e.jsx(p,{placeholder:"Firmen-Ansprechpartner auswählen"})}),e.jsxs(x,{children:[e.jsx(r,{value:"0",children:"Kein Ansprechpartner"}),C.map(t=>e.jsxs(r,{value:t.id.toString(),children:[t.name,t.department&&` (${t.department})`,t.position&&` - ${t.position}`]},t.id))]})]}),C.length===0&&s.companyId&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Keine Ansprechpartner für diese Firma vorhanden.",e.jsx(m,{href:"/companies",className:"text-blue-500 hover:underline ml-1",children:"Ansprechpartner hinzufügen"})]})]})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Budget und Termine"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"budget",children:"Budget (€)"}),e.jsx(l,{id:"budget",type:"number",value:s.budget,onChange:t=>i("budget",t.target.value),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"startDate",children:"Startdatum"}),e.jsx(l,{id:"startDate",type:"date",value:s.startDate,onChange:t=>i("startDate",t.target.value)})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"endDate",children:"Enddatum"}),e.jsx(l,{id:"endDate",type:"date",value:s.endDate,onChange:t=>i("endDate",t.target.value)})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Standort"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(a,{htmlFor:"latitude",children:"Breitengrad"}),e.jsx(l,{id:"latitude",type:"number",step:"any",value:s.latitude,onChange:t=>i("latitude",t.target.value),placeholder:"z.B. 48.1351"})]}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"longitude",children:"Längengrad"}),e.jsx(l,{id:"longitude",type:"number",step:"any",value:s.longitude,onChange:t=>i("longitude",t.target.value),placeholder:"z.B. 11.5820"})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Projektfortschritt"}),e.jsxs("div",{children:[e.jsx(a,{htmlFor:"completionPercentage",children:"Fortschritt (%)"}),e.jsx(l,{id:"completionPercentage",type:"number",min:"0",max:"100",value:s.completionPercentage,onChange:t=>i("completionPercentage",parseInt(t.target.value)||0),placeholder:"0"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsxs(v,{type:"submit",disabled:y.isPending,className:"flex-1",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),y.isPending?"Speichere...":"Projekt speichern"]}),e.jsx(m,{href:`/projects/${d}`,children:e.jsx(v,{variant:"outline",className:"flex-1",children:"Abbrechen"})})]})]})})]})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Projekt nicht gefunden"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Das angeforderte Projekt existiert nicht."}),e.jsx(m,{href:"/projects",children:e.jsx(v,{children:"Zurück zu Projekten"})})]})})}export{ae as default};
