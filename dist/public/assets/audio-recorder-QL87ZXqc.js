import{c as C,e as ee,r as t,u as se,y as te,w as E,z as U,j as e,B as c,X as ae,C as p,a as f,b as S,d as k,D as A,I as re,A as G}from"./index-CyhjQ_VK.js";import{S as ne,a as ie,b as ce,c as le,d as oe}from"./select-D1rr0yyK.js";import{T as de}from"./textarea-BuGvpmpE.js";import{B as ue}from"./badge-BZr39Q1C.js";import{M as he}from"./map-pin-LITRY39W.js";import{M as me}from"./mic-COeeLFIv.js";import{P as xe}from"./play-C5EHXXPK.js";import{T as pe}from"./trash-2-Bnck2P-r.js";import{S as fe}from"./save-BWvkuADS.js";import{C as je}from"./clock-I34conbD.js";import{D as ge}from"./download-DSsmF7Wj.js";import"./index-BdQq_4o_.js";import"./Combination-DDccCRPx.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=C("FileAudio",[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=C("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=C("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);function Ie(){const[,K]=ee(),[o,j]=t.useState(!1),[d,u]=t.useState(!1),[l,R]=t.useState(null),[P,T]=t.useState(null),[D,h]=t.useState(0),[m,z]=t.useState(""),[M,F]=t.useState(""),[g,v]=t.useState(""),[r,O]=t.useState(null),[I,y]=t.useState(!1),n=t.useRef(null),w=t.useRef([]),i=t.useRef(null),{toast:x}=se(),Q=te(),{data:V=[]}=E({queryKey:["/api/projects"]}),{data:B=[]}=E({queryKey:["/api/audio-records"]}),N=U({mutationFn:async s=>await G("/api/audio-records","POST",s),onSuccess:()=>{x({title:"Audio-Aufnahme gespeichert",description:"Die Aufnahme wurde erfolgreich zum Projekt hinzugefügt."}),Q.invalidateQueries({queryKey:["/api/audio-records"]}),q()},onError:s=>{x({title:"Fehler beim Speichern",description:"Die Audio-Aufnahme konnte nicht gespeichert werden.",variant:"destructive"})}}),H=U({mutationFn:async s=>await G("/api/audio/transcribe","POST",{audioData:s}),onSuccess:s=>{v(s.transcription),y(!1)},onError:s=>{x({title:"Transkription fehlgeschlagen",description:"Die Spracherkennung konnte nicht durchgeführt werden.",variant:"destructive"}),y(!1)}});t.useEffect(()=>(Z(),()=>{i.current&&clearInterval(i.current)}),[]);const Z=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(s=>{O({lat:s.coords.latitude,lng:s.coords.longitude})},s=>{console.error("GPS-Fehler:",s)})},$=async()=>{try{const s=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});n.current=new MediaRecorder(s,{mimeType:"audio/webm;codecs=opus"}),w.current=[],n.current.ondataavailable=a=>{a.data.size>0&&w.current.push(a.data)},n.current.onstop=()=>{const a=new Blob(w.current,{type:"audio/webm"});R(a),T(URL.createObjectURL(a)),s.getTracks().forEach(b=>b.stop())},n.current.start(1e3),j(!0),u(!1),h(0),i.current=setInterval(()=>{h(a=>a+1)},1e3)}catch(s){console.error("Mikrofon-Zugriff fehlgeschlagen:",s),x({title:"Mikrofon-Fehler",description:"Zugriff auf das Mikrofon fehlgeschlagen. Bitte Berechtigungen prüfen.",variant:"destructive"})}},X=()=>{n.current&&o&&(d?(n.current.resume(),i.current=setInterval(()=>{h(s=>s+1)},1e3)):(n.current.pause(),i.current&&clearInterval(i.current)),u(!d))},J=()=>{n.current&&o&&(n.current.stop(),j(!1),u(!1),i.current&&clearInterval(i.current))},q=()=>{R(null),T(null),h(0),F(""),v(""),z(""),j(!1),u(!1)},W=async()=>{if(!l)return;y(!0);const s=new FileReader;s.onloadend=()=>{const a=s.result;H.mutate(a)},s.readAsDataURL(l)},Y=()=>{if(!l||!m)return;const s=new FileReader;s.onloadend=()=>{const a=s.result;N.mutate({projectId:parseInt(m),description:M,audioData:a,duration:D,transcription:g||void 0,latitude:r==null?void 0:r.lat,longitude:r==null?void 0:r.lng})},s.readAsDataURL(l)},L=s=>{const a=Math.floor(s/60),b=s%60;return`${a.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}`},_=()=>{K("/")};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:_,children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx("h1",{className:"font-semibold text-gray-900",children:"Audio-Aufnahme"}),e.jsx("div",{className:"w-8"})]})})}),e.jsxs("div",{className:"p-4 space-y-6",children:[r&&e.jsx(p,{children:e.jsx(f,{className:"p-3",children:e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(he,{className:"h-4 w-4 text-green-500"}),e.jsxs("span",{children:["GPS: ",r.lat.toFixed(6),", ",r.lng.toFixed(6)]})]})})}),e.jsxs(p,{children:[e.jsx(S,{children:e.jsxs(k,{className:"flex items-center space-x-2",children:[e.jsx(ve,{className:"h-5 w-5"}),e.jsx("span",{children:"Sprachaufnahme"})]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"text-3xl font-mono text-gray-700",children:L(D)}),o&&e.jsx(ue,{variant:d?"secondary":"destructive",className:"animate-pulse",children:d?"Pausiert":"Aufnahme läuft"}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[!o&&!l&&e.jsx(c,{onClick:$,size:"lg",className:"w-16 h-16 rounded-full bg-red-500 hover:bg-red-600",children:e.jsx(me,{className:"h-6 w-6 text-white"})}),o&&e.jsxs(e.Fragment,{children:[e.jsx(c,{onClick:X,size:"lg",variant:"outline",className:"w-16 h-16 rounded-full",children:d?e.jsx(xe,{className:"h-6 w-6"}):e.jsx(ye,{className:"h-6 w-6"})}),e.jsx(c,{onClick:J,size:"lg",className:"w-16 h-16 rounded-full bg-gray-700 hover:bg-gray-800",children:e.jsx(we,{className:"h-6 w-6 text-white"})})]}),l&&e.jsx(c,{onClick:q,size:"lg",variant:"outline",className:"w-16 h-16 rounded-full",children:e.jsx(pe,{className:"h-6 w-6"})})]})]}),P&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("audio",{controls:!0,className:"w-full",children:[e.jsx("source",{src:P,type:"audio/webm"}),"Ihr Browser unterstützt das Audio-Element nicht."]}),e.jsx("div",{className:"flex space-x-2",children:e.jsx(c,{onClick:W,disabled:I,variant:"outline",className:"flex-1",children:I?"Transkribiere...":"Sprache zu Text"})})]})]})]}),l&&e.jsxs(p,{children:[e.jsx(S,{children:e.jsx(k,{children:"Aufnahme-Details"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"project-select",children:"Projekt auswählen *"}),e.jsxs(ne,{value:m,onValueChange:z,children:[e.jsx(ie,{children:e.jsx(ce,{placeholder:"Projekt auswählen..."})}),e.jsx(le,{children:V.map(s=>e.jsxs(oe,{value:s.id.toString(),children:[s.name," (#",s.id,")"]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"description",children:"Beschreibung"}),e.jsx(re,{id:"description",placeholder:"Kurze Beschreibung der Aufnahme...",value:M,onChange:s=>F(s.target.value)})]}),g&&e.jsxs("div",{children:[e.jsx(A,{htmlFor:"transcription",children:"Transkription"}),e.jsx(de,{id:"transcription",value:g,onChange:s=>v(s.target.value),rows:4,placeholder:"Automatisch generierte Transkription..."})]}),e.jsxs(c,{onClick:Y,disabled:!m||N.isPending,className:"w-full",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),N.isPending?"Speichert...":"Aufnahme speichern"]})]})]}),B.length>0&&e.jsxs(p,{children:[e.jsx(S,{children:e.jsx(k,{children:"Letzte Aufnahmen"})}),e.jsx(f,{children:e.jsx("div",{className:"space-y-3",children:B.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm",children:s.description||"Unbenannte Aufnahme"}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[e.jsx(je,{className:"h-3 w-3"}),e.jsx("span",{children:L(s.duration)}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(s.recordedAt).toLocaleDateString("de-DE")})]})]}),e.jsx(c,{variant:"ghost",size:"sm",children:e.jsx(ge,{className:"h-4 w-4"})})]},s.id))})})]})]})]})}export{Ie as default};
