import{c as g,v as J,e as Z,r as j,u as $,y as X,w as Y,z as E,j as e,C as r,a as c,B as l,I as _,b as O,a4 as P,A as w}from"./index-CyhjQ_VK.js";import{B as A}from"./badge-BZr39Q1C.js";import{A as ee}from"./app-layout-BmSq0-fU.js";import{P as se}from"./page-header-CfMEZ_QD.js";import{F as x}from"./file-text-BJnhxmUe.js";import{U as F}from"./upload-DB7pjTN6.js";import{S as B}from"./search-_i4Cbbz2.js";import{E as I}from"./ellipsis-vertical-CKkbyHks.js";import{C as te}from"./calendar-DrNP2I0J.js";import{D as T}from"./download-DSsmF7Wj.js";import"./users-cXk-SK6P.js";import"./building-2-C2UTDJSA.js";import"./settings-RhnSVDqX.js";import"./shield-DX56K7pi.js";import"./mobile-nav-Cu-R2ZoU.js";import"./camera-BUbOfpe-.js";import"./mic-COeeLFIv.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=g("FileArchive",[["path",{d:"M10 12v-1",key:"v7bkov"}],["path",{d:"M10 18v-2",key:"1cjy8d"}],["path",{d:"M10 7V6",key:"dljcrl"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M15.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v16a2 2 0 0 0 .274 1.01",key:"gkbcor"}],["circle",{cx:"10",cy:"20",r:"2",key:"1xzdoj"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=g("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=g("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=g("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=g("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),ie=t=>t.startsWith("image/")?"image":t.startsWith("audio/")?"audio":t.includes("pdf")?"pdf":t.includes("zip")||t.includes("rar")||t.includes("tar")?"archive":"document",ne=t=>{if(t===0)return"0 Bytes";const d=1024,f=["Bytes","KB","MB","GB"],h=Math.floor(Math.log(t)/Math.log(d));return parseFloat((t/Math.pow(d,h)).toFixed(2))+" "+f[h]},ce=t=>t.startsWith("image/")?"photos":t.startsWith("audio/")?"audio":t.includes("pdf")||t.includes("plan")||t.includes("drawing")?"plans":t.includes("doc")||t.includes("txt")?"documents":"other";function Se(){const{user:t}=J();Z();const[d,f]=j.useState(""),[h,q]=j.useState("all"),[y,k]=j.useState("grid"),[D,G]=j.useState("all"),S=j.useRef(null),{toast:N}=$(),v=X(),{data:R=[],isLoading:m,error:u}=Y({queryKey:["/api/attachments"],queryFn:async()=>{try{const s=await w("GET","/api/attachments");if(!s.ok){if(s.status===404)return[];throw new Error("Failed to fetch documents")}const a=await s.json();return Array.isArray(a)?a:[]}catch{return console.log("No documents found yet - this is normal for new users"),[]}},retry:!1,refetchOnWindowFocus:!1}),i=R.map(s=>({id:s.id,fileName:s.fileName,filePath:s.filePath,fileSize:s.fileSize,mimeType:s.mimeType,name:s.fileName,type:ie(s.mimeType||s.fileName),size:ne(s.fileSize||0),uploadDate:new Date(s.createdAt).toLocaleDateString("de-DE"),projectId:s.projectId,category:ce(s.mimeType||s.fileName),sftpPath:s.sftpPath,uploadedBy:s.uploadedBy,createdAt:s.createdAt})),o=i.filter(s=>{const a=s.name.toLowerCase().includes(d.toLowerCase())||s.projectName&&s.projectName.toLowerCase().includes(d.toLowerCase()),n=h==="all"||s.category===h,p=D==="all"||s.category===D;return a&&n&&p}),b=E({mutationFn:async s=>{const a=new FormData;a.append("file",s.file),s.projectId&&a.append("projectId",String(s.projectId));const n=await fetch("/api/upload",{method:"POST",credentials:"include",body:a});if(!n.ok)throw new Error("File upload failed");const p=await n.json(),Q={fileName:s.file.name,filePath:p.filePath,fileSize:s.file.size,mimeType:s.file.type,projectId:s.projectId||null,sftpPath:p.sftpPath||p.filePath},M=await w("POST","/api/attachments",Q);if(!M.ok)throw new Error("Attachment record creation failed");return M.json()},onSuccess:()=>{N({title:"Upload erfolgreich",description:"Das Dokument wurde erfolgreich hochgeladen."}),v.invalidateQueries({queryKey:["/api/attachments"]})},onError:s=>{N({title:"Upload fehlgeschlagen",description:"Das Dokument konnte nicht hochgeladen werden.",variant:"destructive"}),console.error("Upload error:",s)}}),V=E({mutationFn:async s=>{const a=await w("DELETE",`/api/attachments/${s}`);if(!a.ok)throw new Error("Delete failed");return a.json()},onSuccess:()=>{N({title:"Dokument gelöscht",description:"Das Dokument wurde erfolgreich entfernt."}),v.invalidateQueries({queryKey:["/api/attachments"]})},onError:()=>{N({title:"Fehler",description:"Das Dokument konnte nicht gelöscht werden.",variant:"destructive"})}}),H=()=>{var s;(s=S.current)==null||s.click()},W=s=>{var n;const a=(n=s.target.files)==null?void 0:n[0];a&&b.mutate({file:a})},K=s=>{confirm("Möchten Sie dieses Dokument wirklich löschen?")&&V.mutate(s)},z=s=>{switch(s){case"image":return e.jsx(L,{className:"h-5 w-5"});case"audio":return e.jsx(U,{className:"h-5 w-5"});case"pdf":case"document":return e.jsx(x,{className:"h-5 w-5"});case"archive":return e.jsx(ae,{className:"h-5 w-5"});default:return e.jsx(x,{className:"h-5 w-5"})}},C=s=>{switch(s){case"image":return"bg-green-100 text-green-800";case"audio":return"bg-purple-100 text-purple-800";case"pdf":return"bg-red-100 text-red-800";case"document":return"bg-blue-100 text-blue-800";case"archive":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs(ee,{children:[e.jsx(se,{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Meine Dokumente"})})})}),e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[u&&e.jsx(r,{className:"mb-6 border-red-200 bg-red-50",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx(x,{className:"h-12 w-12 mx-auto"})}),e.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Fehler beim Laden der Dokumente"}),e.jsx("p",{className:"text-red-700 mb-4",children:"Die Dokumente konnten nicht geladen werden. Bitte versuchen Sie es erneut."}),e.jsx(l,{onClick:()=>v.invalidateQueries({queryKey:["/api/attachments"]}),variant:"outline",className:"border-red-300 text-red-700 hover:bg-red-100",children:"Erneut versuchen"})]})})}),e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-blue-600 rounded-xl p-1 mb-6 shadow-xl",children:e.jsx(r,{className:"border-0 bg-white m-0",children:e.jsx(c,{className:"p-10",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-100 to-blue-100 rounded-full p-8 mb-6 inline-block",children:e.jsx(F,{className:"h-16 w-16 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"🚀 SFTP-DATEI-UPLOAD (v3.0 - CACHE-RESET)"}),e.jsx("p",{className:"text-gray-700 mb-8 text-lg",children:"Direkter Upload zu Ihrem SFTP-Server: 128.140.82.20"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(l,{onClick:H,size:"lg",className:"bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 text-white px-12 py-4 text-lg font-semibold shadow-2xl transform hover:scale-105 transition-all duration-200",disabled:b.isPending,children:[e.jsx(F,{className:"h-6 w-6 mr-3"}),e.jsx("span",{className:"font-bold",children:b.isPending?"🔄 SFTP-ÜBERTRAGUNG LÄUFT...":"⚡ JETZT DATEIEN HOCHLADEN ⚡"})]}),e.jsx("input",{ref:S,type:"file",multiple:!0,onChange:W,accept:"image/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx,.zip,.rar",className:"hidden"},"sftp-upload-input-v3"),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-sm text-gray-600",children:[e.jsx("p",{className:"font-semibold mb-2",children:"📁 Unterstützte Dateiformate:"}),e.jsx("p",{children:"🖼️ Bilder • 🎵 Audio • 📄 PDF • 📊 Office • 📦 Archive"}),e.jsx("p",{className:"mt-2 text-green-600 font-semibold",children:"🔒 Sichere Verschlüsselung zum SFTP-Server"})]})]})]})})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"h-4 w-4 absolute left-3 top-3 text-gray-400"}),e.jsx(_,{placeholder:"Dokumente durchsuchen...",value:d,onChange:s=>f(s.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:y==="grid"?"default":"outline",size:"sm",onClick:()=>k("grid"),children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx(l,{variant:y==="list"?"default":"outline",size:"sm",onClick:()=>k("list"),children:e.jsx(le,{className:"h-4 w-4"})})]})]}),e.jsx(r,{className:"mb-6 bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"SFTP-Speicher"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Server: 128.140.82.20"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-600",children:"0 MB von 1 GB belegt"}),e.jsx("div",{className:"w-32 h-2 bg-gray-200 rounded-full mt-1",children:e.jsx("div",{className:"w-0 h-2 bg-blue-500 rounded-full"})})]})]})})}),m&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Dokumente werden geladen..."})]}),!m&&!u&&i.length===0&&e.jsx(r,{className:"text-center py-16",children:e.jsx(c,{children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("div",{className:"bg-blue-100 rounded-full p-8 mb-6 inline-block",children:e.jsx(x,{className:"h-20 w-20 text-blue-600"})}),e.jsx("h3",{className:"text-2xl font-semibold text-gray-900 mb-4",children:"Willkommen in Ihrem Dokumentenbereich!"}),e.jsx("p",{className:"text-gray-600 mb-8 leading-relaxed",children:"Hier können Sie alle wichtigen Dateien für Ihre Bauprojekte verwalten: Fotos von Baustellen, Baupläne, Sprachaufnahmen, Berichte und andere Dokumente."}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Verwenden Sie den grünen SFTP-Upload-Button oben, um Ihr erstes Dokument hochzuladen."}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[e.jsx("p",{children:e.jsx("strong",{children:"Unterstützte Dateiformate:"})}),e.jsx("p",{children:"📷 Bilder (JPG, PNG, GIF)"}),e.jsx("p",{children:"🎵 Audio (MP3, WAV, M4A)"}),e.jsx("p",{children:"📄 Dokumente (PDF, DOC, XLS)"}),e.jsx("p",{children:"📦 Archive (ZIP, RAR)"})]})]})]})})}),!m&&!u&&i.length>0&&o.length===0&&e.jsx(r,{className:"text-center py-12",children:e.jsx(c,{children:e.jsxs("div",{className:"max-w-sm mx-auto",children:[e.jsx("div",{className:"bg-gray-100 rounded-full p-6 mb-4 inline-block",children:e.jsx(B,{className:"h-12 w-12 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Keine passenden Dokumente gefunden"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Versuchen Sie andere Suchbegriffe oder ändern Sie die Filtereinstellungen."}),e.jsx(l,{onClick:()=>{f(""),q("all"),G("all")},variant:"outline",children:"Filter zurücksetzen"})]})})}),!m&&!u&&o.length>0&&y==="grid"&&e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:o.map(s=>e.jsxs(r,{className:"hover:shadow-lg transition-shadow group",children:[e.jsx(O,{className:"pb-2",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:z(s.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.uploadDate})]})]}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>K(s.id),className:"opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(I,{className:"h-4 w-4"})})]})}),e.jsx(c,{className:"pt-0",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx(A,{variant:"secondary",className:C(s.type),children:s.type.toUpperCase()}),e.jsx("span",{className:"text-gray-500",children:s.size})]}),s.projectName&&e.jsxs("p",{className:"text-xs text-blue-600 truncate",children:["📁 ",s.projectName]}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),new Date(s.uploadDate).toLocaleDateString("de-DE")]}),e.jsxs("div",{className:"flex space-x-1 pt-2",children:[e.jsxs(l,{size:"sm",variant:"outline",className:"flex-1",children:[e.jsx(P,{className:"h-3 w-3 mr-1"}),"Öffnen"]}),e.jsx(l,{size:"sm",variant:"outline",children:e.jsx(T,{className:"h-3 w-3"})})]})]})})]},s.id))}),!m&&!u&&o.length>0&&y==="list"&&e.jsx(r,{children:e.jsx(c,{className:"p-0",children:e.jsx("div",{className:"overflow-hidden",children:o.map((s,a)=>e.jsxs("div",{className:`flex items-center p-4 hover:bg-gray-50 transition-colors ${a!==o.length-1?"border-b":""}`,children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:z(s.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:s.name}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsx("span",{children:s.size}),e.jsx("span",{children:new Date(s.uploadDate).toLocaleDateString("de-DE")}),s.projectName&&e.jsxs("span",{className:"text-blue-600",children:["📁 ",s.projectName]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{variant:"secondary",className:C(s.type),children:s.type.toUpperCase()}),e.jsx(l,{variant:"ghost",size:"sm",children:e.jsx(P,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"sm",children:e.jsx(T,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"sm",children:e.jsx(I,{className:"h-4 w-4"})})]})]},s.id))})})}),e.jsxs("div",{className:"mt-8 grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Gesamt"})]})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.filter(s=>s.type==="image").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Fotos"})]})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"h-5 w-5 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.filter(s=>s.type==="audio").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Audio"})]})]})}),e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{className:"h-5 w-5 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.filter(s=>s.type==="pdf"||s.type==="document").length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Dokumente"})]})]})})]})]})]})}export{Se as default};
