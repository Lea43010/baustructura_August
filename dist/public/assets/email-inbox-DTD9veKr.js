import{c as L,r as l,u as U,y as D,w as b,z as v,j as e,C as c,a as d,t as $,B as o,af as C,I as H,b as M,d as S,M as p,i as K,U as Q}from"./index-CyhjQ_VK.js";import{B as k}from"./badge-BZr39Q1C.js";import{T as B}from"./textarea-BuGvpmpE.js";import{S as W}from"./search-_i4Cbbz2.js";import{F as J}from"./filter-BOfI08NM.js";import{M as V}from"./message-square-DaYXvbtd.js";import{C as Z}from"./clock-I34conbD.js";import{S as G}from"./send-xpb4yocX.js";import{f as E,d as A}from"./de-Cf62G93d.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=L("MailOpen",[["path",{d:"M21.2 8.4c.5.38.8.97.8 1.6v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V10a2 2 0 0 1 .8-1.6l8-6a2 2 0 0 1 2.4 0l8 6Z",key:"1jhwl8"}],["path",{d:"m22 10-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 10",key:"1qfld7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=L("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);function de(){var w;const[a,j]=l.useState(null),[i,f]=l.useState(""),[r,I]=l.useState(""),[n,F]=l.useState(!1),{toast:y}=U(),R=D(),{data:N=[],isLoading:m,error:T,refetch:O}=b({queryKey:["/api/email/inbox",{unreadOnly:n}],queryFn:async()=>{const s=new URLSearchParams;n&&s.append("unreadOnly","true");const t=await fetch(`/api/email/inbox?${s}`);if(!t.ok)throw new Error("Failed to fetch messages");return t.json()},refetchInterval:3e4}),{data:_}=b({queryKey:["/api/email/test"],queryFn:async()=>{const s=await fetch("/api/email/test");if(!s.ok)throw new Error("Failed to test connection");return s.json()}}),x=v({mutationFn:async s=>{const t=await fetch(`/api/email/message/${s}/read`,{method:"POST"});if(!t.ok)throw new Error("Failed to mark as read");return t.json()},onSuccess:()=>{R.invalidateQueries({queryKey:["/api/email/inbox"]})}}),h=v({mutationFn:async({messageId:s,content:t})=>{const g=await fetch(`/api/email/message/${s}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:t})});if(!g.ok)throw new Error("Failed to send reply");return g.json()},onSuccess:()=>{y({title:"Antwort gesendet",description:"Ihre Antwort wurde erfolgreich versendet."}),f(""),j(null)},onError:()=>{y({title:"Fehler",description:"Antwort konnte nicht gesendet werden.",variant:"destructive"})}}),u=N.filter(s=>s.subject.toLowerCase().includes(r.toLowerCase())||s.from.name.toLowerCase().includes(r.toLowerCase())||s.from.email.toLowerCase().includes(r.toLowerCase())||s.bodyPreview.toLowerCase().includes(r.toLowerCase())),P=N.filter(s=>!s.isRead).length,z=async s=>{j(s),s.isRead||x.mutate(s.id)},q=()=>{a&&i.trim()&&h.mutate({messageId:a.id,content:i})};return T?e.jsx("div",{className:"p-6",children:e.jsx(c,{className:"border-red-200 bg-red-50",children:e.jsxs(d,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-red-600",children:[e.jsx($,{className:"h-5 w-5"}),e.jsx("span",{children:"Fehler beim Laden der E-Mails"})]}),e.jsx("p",{className:"text-sm text-red-500 mt-2",children:"Überprüfen Sie die Microsoft 365 Konfiguration oder kontaktieren Sie den Administrator."})]})})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Support E-Mail Inbox"}),e.jsxs("p",{className:"text-gray-600",children:["support@bau-structura.de • ",P," ungelesene Nachrichten"]}),e.jsx("p",{className:"text-sm text-orange-600 mt-1",children:"⚠️ SIMULATION: Demo-E-Mails zu Testzwecken - Für echte E-Mail-Integration Microsoft 365 konfigurieren"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{variant:"secondary",className:"bg-orange-50 text-orange-700 border-orange-200",children:"⚠️ SIMULATION"}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>O(),disabled:m,children:[e.jsx(C,{className:`h-4 w-4 mr-2 ${m?"animate-spin":""}`}),"Aktualisieren"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(H,{placeholder:"E-Mails durchsuchen...",value:r,onChange:s=>I(s.target.value),className:"pl-10"})]}),e.jsxs(o,{variant:n?"default":"outline",size:"sm",onClick:()=>F(!n),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),n?"Alle anzeigen":"Nur ungelesene"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(c,{children:[e.jsx(M,{children:e.jsxs(S,{className:"flex items-center",children:[e.jsx(V,{className:"h-5 w-5 mr-2"}),"E-Mails (",u.length,")"]})}),e.jsx(d,{className:"p-0",children:m?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(C,{className:"h-8 w-8 animate-spin mx-auto mb-2"}),"Lade E-Mails..."]}):u.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(p,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),r?"Keine E-Mails gefunden":"Keine E-Mails vorhanden"]}):e.jsx("div",{className:"divide-y",children:u.map(s=>e.jsx("div",{className:`p-4 hover:bg-gray-50 cursor-pointer transition-colors ${s.isRead?"":"bg-blue-50 border-l-4 border-l-blue-500"} ${(a==null?void 0:a.id)===s.id?"bg-green-50":""}`,onClick:()=>z(s),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[s.isRead?e.jsx(X,{className:"h-4 w-4 text-gray-400"}):e.jsx(p,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-medium text-gray-900 truncate",children:s.from.name}),e.jsx("span",{className:"text-sm text-gray-500 truncate",children:s.from.email}),s.hasAttachments&&e.jsx(Y,{className:"h-4 w-4 text-gray-400"})]}),e.jsx("h3",{className:`text-sm mb-1 truncate ${s.isRead?"text-gray-700":"font-semibold text-gray-900"}`,children:s.subject}),e.jsx("p",{className:"text-sm text-gray-500 line-clamp-2",children:s.bodyPreview})]}),e.jsxs("div",{className:"flex flex-col items-end space-y-1 ml-4",children:[e.jsx("span",{className:"text-xs text-gray-500",children:E(new Date(s.receivedDateTime),"dd.MM.yy HH:mm",{locale:A})}),!s.isRead&&e.jsx(k,{variant:"default",className:"text-xs",children:"Neu"})]})]})},s.id))})})]})}),e.jsx("div",{className:"lg:col-span-1",children:a?e.jsxs(c,{children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{className:"text-lg",children:"Nachricht Details"}),e.jsx("div",{className:"flex items-center space-x-2",children:!a.isRead&&e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>x.mutate(a.id),disabled:x.isPending,children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Als gelesen markieren"]})})]})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:a.subject}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600 mb-4",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:a.from.name}),e.jsxs("span",{children:["(",a.from.email,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500 mb-4",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsxs("span",{children:[E(new Date(a.receivedDateTime),"dd.MM.yyyy, HH:mm",{locale:A})," Uhr"]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Nachricht:"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded text-sm whitespace-pre-wrap",children:((w=a.body)==null?void 0:w.content)||a.bodyPreview})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Antworten:"}),e.jsx(B,{placeholder:"Ihre Antwort...",value:i,onChange:s=>f(s.target.value),className:"mb-3",rows:4}),e.jsxs(o,{onClick:q,disabled:!i.trim()||h.isPending,className:"w-full",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),h.isPending?"Wird gesendet...":"Antwort senden"]})]})]})]}):e.jsx(c,{children:e.jsxs(d,{className:"p-8 text-center text-gray-500",children:[e.jsx(p,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Wählen Sie eine E-Mail aus, um Details anzuzeigen"})]})})})]})]})}export{de as default};
