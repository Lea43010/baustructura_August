import{v as X,u as Y,y as _,r as g,w as ee,z as I,j as e,x as se,B as t,C as y,b as z,d as H,M as G,a6 as q,a as w,D as d,I as K,t as ie,A as L}from"./index-CyhjQ_VK.js";import{T as S}from"./textarea-BuGvpmpE.js";import{S as C,a as T,b as B,c as k,d as n}from"./select-D1rr0yyK.js";import{B as c}from"./badge-BZr39Q1C.js";import{D as re,f as te,a as ae,b as ne,c as le,d as ce}from"./dialog-DY-DCoN7.js";import{A as de}from"./arrow-left-C8JrTeqc.js";import{P as oe}from"./plus-D7MkCcQh.js";import{f as O,d as Q}from"./de-Cf62G93d.js";import{C as ue}from"./clock-I34conbD.js";import{S as he}from"./square-pen-DsHIieuw.js";import"./index-BdQq_4o_.js";import"./Combination-DDccCRPx.js";function Te(){const{user:a}=X(),{toast:u}=Y(),F=_(),[v,x]=g.useState(!1),[M,b]=g.useState(null),[l,m]=g.useState({subject:"",description:"",priority:"medium"}),[i,h]=g.useState({subject:"",description:"",priority:"medium",status:"",updateMessage:""}),{data:A=[],isLoading:V}=ee({queryKey:["/api/support-tickets"]}),f=I({mutationFn:async s=>await(await L("/api/support-tickets","POST",s)).json(),onSuccess:()=>{F.invalidateQueries({queryKey:["/api/support-tickets"]}),m({subject:"",description:"",priority:"medium"}),x(!1),u({title:"Ticket erstellt",description:"Ihr Support-Ticket wurde erfolgreich erstellt. Sie erhalten eine E-Mail-Bestätigung."})},onError:s=>{u({title:"Fehler",description:s.message||"Fehler beim Erstellen des Support-Tickets",variant:"destructive"})}}),o=I({mutationFn:async({id:s,status:r,updateMessage:j,subject:D,description:P,priority:E})=>{const p={};return r&&(p.status=r),j&&(p.updateMessage=j),D&&(p.subject=D),P&&(p.description=P),E&&(p.priority=E),await(await L(`/api/support-tickets/${s}`,"PATCH",p)).json()},onSuccess:()=>{F.invalidateQueries({queryKey:["/api/support-tickets"]}),b(null),u({title:"Ticket aktualisiert",description:"Das Support-Ticket wurde erfolgreich aktualisiert."})},onError:s=>{u({title:"Fehler",description:s.message||"Fehler beim Aktualisieren des Support-Tickets",variant:"destructive"})}}),$=()=>{if(!l.subject.trim()||!l.description.trim()){u({title:"Fehlende Angaben",description:"Bitte füllen Sie Betreff und Beschreibung aus.",variant:"destructive"});return}f.mutate(l)},N=(s,r)=>{const j=`Status geändert zu: ${J(r)}`;o.mutate({id:s,status:r,updateMessage:j})},R=s=>{b(s),h({subject:s.subject,description:s.description,priority:s.priority,status:s.status,updateMessage:""})},U=()=>{if(!M||!i.subject.trim()||!i.description.trim()){u({title:"Fehlende Angaben",description:"Bitte füllen Sie alle Pflichtfelder aus.",variant:"destructive"});return}o.mutate({id:M.id,subject:i.subject,description:i.description,priority:i.priority,status:i.status,updateMessage:i.updateMessage||`Ticket bearbeitet: ${i.subject}`})},W=s=>{switch(s){case"open":return e.jsx(c,{variant:"destructive",children:"📋 Offen"});case"in-progress":return e.jsx(c,{variant:"default",children:"⚙️ In Bearbeitung"});case"resolved":return e.jsx(c,{variant:"secondary",children:"✅ Gelöst"});case"closed":return e.jsx(c,{variant:"outline",children:"🔒 Geschlossen"});default:return e.jsx(c,{variant:"outline",children:s})}},Z=s=>{switch(s){case"high":return e.jsx(c,{variant:"destructive",children:"🔴 Hoch"});case"medium":return e.jsx(c,{variant:"default",children:"🟡 Mittel"});case"low":return e.jsx(c,{variant:"secondary",children:"🟢 Niedrig"});default:return e.jsx(c,{variant:"outline",children:s})}},J=s=>{switch(s){case"open":return"Offen";case"in-progress":return"In Bearbeitung";case"resolved":return"Gelöst";case"closed":return"Geschlossen";default:return s}};return V?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-blue-50 p-4",children:e.jsx("div",{className:"flex items-center justify-center pt-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Support-Tickets werden geladen..."})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-blue-50",children:e.jsxs("div",{className:"container mx-auto p-4 max-w-6xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(se,{href:"/",children:e.jsx(t,{variant:"ghost",size:"sm",children:e.jsx(de,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Support Center"}),e.jsx("p",{className:"text-gray-600",children:"Erstellen und verwalten Sie Support-Tickets"})]})]}),e.jsxs(t,{onClick:()=>x(!v),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Neues Ticket"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[v&&e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(y,{children:[e.jsxs(z,{children:[e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Neues Support-Ticket"]}),e.jsx(q,{children:"Beschreiben Sie Ihr Anliegen ausführlich"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"subject",children:"Betreff *"}),e.jsx(K,{id:"subject",value:l.subject,onChange:s=>m({...l,subject:s.target.value}),placeholder:"Kurze Beschreibung des Problems"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"priority",children:"Priorität"}),e.jsxs(C,{value:l.priority,onValueChange:s=>m({...l,priority:s}),children:[e.jsx(T,{children:e.jsx(B,{})}),e.jsxs(k,{children:[e.jsx(n,{value:"low",children:"🟢 Niedrig"}),e.jsx(n,{value:"medium",children:"🟡 Mittel"}),e.jsx(n,{value:"high",children:"🔴 Hoch"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"description",children:"Beschreibung *"}),e.jsx(S,{id:"description",value:l.description,onChange:s=>m({...l,description:s.target.value}),placeholder:"Detaillierte Beschreibung Ihres Anliegens...",rows:6})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{onClick:$,disabled:f.isPending,className:"bg-green-600 hover:bg-green-700 flex-1",children:f.isPending?"Wird erstellt...":"Ticket erstellen"}),e.jsx(t,{variant:"outline",onClick:()=>x(!1),children:"Abbrechen"})]})]})]})}),e.jsx("div",{className:`${v?"lg:col-span-2":"lg:col-span-3"}`,children:A.length===0?e.jsx(y,{children:e.jsxs(w,{className:"text-center py-12",children:[e.jsx(G,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Keine Support-Tickets"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Sie haben noch keine Support-Tickets erstellt."}),e.jsx(t,{onClick:()=>x(!0),className:"bg-green-600 hover:bg-green-700",children:"Erstes Ticket erstellen"})]})}):e.jsx("div",{className:"space-y-4",children:A.map(s=>e.jsxs(y,{className:"hover:shadow-md transition-shadow",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs(H,{className:"text-lg",children:["#",s.id,": ",s.subject]}),W(s.status),Z(s.priority)]}),e.jsxs(q,{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-4 w-4"}),"Erstellt: ",O(new Date(s.createdAt),"dd.MM.yyyy HH:mm",{locale:Q})]}),s.updatedAt!==s.createdAt&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"h-4 w-4"}),"Aktualisiert: ",O(new Date(s.updatedAt),"dd.MM.yyyy HH:mm",{locale:Q})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[a&&(s.createdBy===a.id||a.role==="admin"||a.role==="manager")&&e.jsxs(re,{children:[e.jsx(te,{asChild:!0,children:e.jsxs(t,{size:"sm",variant:"outline",onClick:()=>R(s),children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"Bearbeiten"]})}),e.jsxs(ae,{className:"max-w-2xl",children:[e.jsxs(ne,{children:[e.jsx(le,{children:"Ticket bearbeiten"}),e.jsxs(ce,{children:["Bearbeiten Sie die Details des Support-Tickets #",s.id]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit-subject",children:"Betreff *"}),e.jsx(K,{id:"edit-subject",value:i.subject,onChange:r=>h({...i,subject:r.target.value}),placeholder:"Betreff des Tickets"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit-description",children:"Beschreibung *"}),e.jsx(S,{id:"edit-description",value:i.description,onChange:r=>h({...i,description:r.target.value}),placeholder:"Detaillierte Beschreibung...",rows:6})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit-priority",children:"Priorität"}),e.jsxs(C,{value:i.priority,onValueChange:r=>h({...i,priority:r}),children:[e.jsx(T,{children:e.jsx(B,{})}),e.jsxs(k,{children:[e.jsx(n,{value:"low",children:"🟢 Niedrig"}),e.jsx(n,{value:"medium",children:"🟡 Mittel"}),e.jsx(n,{value:"high",children:"🔴 Hoch"})]})]})]}),a&&(a.role==="admin"||a.role==="manager")&&e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit-status",children:"Status"}),e.jsxs(C,{value:i.status,onValueChange:r=>h({...i,status:r}),children:[e.jsx(T,{children:e.jsx(B,{})}),e.jsxs(k,{children:[e.jsx(n,{value:"open",children:"📋 Offen"}),e.jsx(n,{value:"in-progress",children:"⚙️ In Bearbeitung"}),e.jsx(n,{value:"resolved",children:"✅ Gelöst"}),e.jsx(n,{value:"closed",children:"🔒 Geschlossen"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit-update-message",children:"Update-Nachricht (Optional)"}),e.jsx(S,{id:"edit-update-message",value:i.updateMessage,onChange:r=>h({...i,updateMessage:r.target.value}),placeholder:"Zusätzliche Informationen zur Änderung...",rows:3})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(t,{variant:"outline",onClick:()=>b(null),children:"Abbrechen"}),e.jsx(t,{onClick:U,disabled:o.isPending,className:"bg-green-600 hover:bg-green-700",children:o.isPending?"Wird gespeichert...":"Änderungen speichern"})]})]})]})]}),a&&(a.role==="admin"||a.role==="manager")&&s.status!=="closed"&&e.jsxs(e.Fragment,{children:[s.status==="open"&&e.jsx(t,{size:"sm",variant:"outline",onClick:()=>N(s.id,"in-progress"),disabled:o.isPending,children:"⚙️ In Bearbeitung"}),s.status==="in-progress"&&e.jsx(t,{size:"sm",variant:"outline",onClick:()=>N(s.id,"resolved"),disabled:o.isPending,children:"✅ Gelöst"}),s.status==="resolved"&&e.jsx(t,{size:"sm",variant:"outline",onClick:()=>N(s.id,"closed"),disabled:o.isPending,children:"🔒 Schließen"})]})]})]})}),e.jsxs(w,{children:[e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.description}),s.assignedTo&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Bearbeiter:"})," ",s.assignedTo]})})]})]},s.id))})})]})]})})}export{Te as default};
